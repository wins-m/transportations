<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>äº¤é€šè½¨è¿¹åœ°å›¾</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
    }

    #map {
      height: 100vh;
      width: 100vw;
    }

    .legend {
      padding: 10px;
      background: white;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    var map = L.map('map').setView([30, 110], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // City coordinates
    var locCoords = {
      "å®æ³¢ç«™": [
        29.8629414928399,
        121.53739804767
      ],
      "æ­å·ä¸œç«™": [
        30.2925,
        120.2119
      ],
      "æ·±åœ³å®å®‰T3": [
        22.627554,
        113.81184
      ],
      "æ­å·è§å±±T4": [
        30.234134,
        120.430634
      ],
      "é¦™æ¸¯è¥¿ä¹é¾™ç«™": [
        22.3047,
        114.1614
      ],
    };

    // 5 sample routes (sorted by type and date)
    var travelSegments = [
      {
        "type": "Railway",
        "date": "2025-04-02",
        "from": "å®æ³¢ç«™",
        "to": "æ­å·ä¸œç«™",
        "vehicle": "D3146",
        "duration": "01:04:00",
        "distance": "1438 km",
        "seat": "07è½¦05A",
        "price": 57,
        "note": "ç§¯åˆ†å…‘æ¢"
      },
      {
        "type": "Airline",
        "date": "2025-02-23",
        "from": "æ·±åœ³å®å®‰T3",
        "to": "æ­å·è§å±±T4",
        "vehicle": "CA1734",
        "duration": "01:36:00",
        "distance": "1179 km",
        "seat": "21A",
        "price": 490,
        "note": "é¦™æ¸¯è¡Œè¿”ç¨‹"
      },
      {
        "type": "Railway",
        "date": "2025-02-21",
        "from": "æ­å·ä¸œç«™",
        "to": "é¦™æ¸¯è¥¿ä¹é¾™ç«™",
        "vehicle": "G899",
        "duration": "10:09:00",
        "distance": "1662 km",
        "seat": "09è½¦032å·ä¸Šé“º",
        "price": 770,
        "note": "é¦™æ¸¯è¡Œå»ç¨‹"
      },

    ];

    // Create smaller markers
    var smallIcon = L.icon({
      iconUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon.png',
      iconSize: [20, 30],  // Smaller size (original: [25, 41])
      iconAnchor: [10, 30], // Anchor point adjustment
      popupAnchor: [0, -30] // Popup position adjustment
    });
    // Add markers with smaller size
    Object.keys(locCoords).forEach(function (city) {
      var coords = locCoords[city];
      L.marker(coords, { icon: smallIcon })
        .addTo(map)
        .bindPopup("<b>" + city + "</b><br>åæ ‡: " + coords[0].toFixed(4) + ", " + coords[1].toFixed(4));
    });

    // Sort by type (Railway > Airline > Other) then by date (newest first)
    travelSegments.sort((a, b) => {
      const typeOrder = { Railway: 1, Airline: 2, Other: 3 };
      if (typeOrder[a.type] !== typeOrder[b.type]) {
        return typeOrder[a.type] - typeOrder[b.type];
      }
      return new Date(b.date) - new Date(a.date);
    });

    // Draw routes with enhanced popups
    travelSegments.forEach(segment => {
      const from = locCoords[segment.from];
      const to = locCoords[segment.to];

      if (from && to) {
        const color = {
          Railway: 'blue',
          Airline: 'red',
          Other: 'gray'
        }[segment.type];

        const polyline = L.polyline([from, to], {
          color: color,
          weight: 3,
          opacity: 0.7
        }).addTo(map);

        // Detailed popup with icons
        const popupContent = `
          <div style="min-width:200px">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
              <span style="font-weight:bold;font-size:1.1em">${segment.from} â†’ ${segment.to}</span>
              <span style="background:${color};color:white;padding:2px 6px;border-radius:4px;font-size:0.8em">
                ${segment.type === 'Railway' ? 'ğŸš„ é“è·¯' : segment.type === 'Airline' ? 'âœˆï¸ èˆªç©º' : 'ğŸšŒ å…¶ä»–'}
              </span>
            </div>
            <table style="width:100%;font-size:0.9em">
              <tr><td style="width:60px">æ—¥æœŸï¼š</td><td>${segment.date}</td></tr>
              <tr><td>è½¦æ¬¡ï¼š</td><td>${segment.vehicle}</td></tr>
              <tr><td>ç”¨æ—¶ï¼š</td><td>${segment.duration}</td></tr>
              ${segment.distance ? `<tr><td>è·ç¦»ï¼š</td><td>${segment.distance}</td></tr>` : ''}
              ${segment.seat ? `<tr><td>åº§ä½ï¼š</td><td>${segment.seat}</td></tr>` : ''}
              ${segment.price ? `<tr><td>ç¥¨ä»·ï¼š</td><td>${segment.price}å…ƒ</td></tr>` : ''}
              ${segment.note ? `<tr><td>å¤‡æ³¨ï¼š</td><td><i>${segment.note}</i></td></tr>` : ''}
            </table>
          </div>
        `;

        polyline.bindPopup(popupContent);
      }
    });

    // Enhanced legend
    var legend = L.control({ position: 'bottomright' });
    legend.onAdd = function () {
      var div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `
        <h4 style="margin:4px 0">äº¤é€šç±»å‹</h4>
        <div style="display:flex;align-items:center;gap:6px;margin:4px 0">
          <div style="background:blue;width:16px;height:16px"></div>
          <span>é“è·¯</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px;margin:4px 0">
          <div style="background:red;width:16px;height:16px"></div>
          <span>èˆªç©º</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px;margin:4px 0">
          <div style="background:green;width:16px;height:16px"></div>
          <span>å…¶ä»–</span>
        </div>
      `;
      return div;
    };
    legend.addTo(map);

    // Auto-fit map to show all markers
    var markers = [];
    Object.keys(locCoords).forEach(function (city) {
      markers.push(L.latLng(locCoords[city]));
    });
    map.fitBounds(L.latLngBounds(markers), { padding: [50, 50] });

  </script>
</body>

</html>